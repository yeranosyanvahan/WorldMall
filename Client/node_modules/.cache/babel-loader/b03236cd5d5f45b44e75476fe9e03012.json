{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DgraphClientStub = void 0;\n\nvar fetch = require(\"isomorphic-fetch\");\n\nvar jwt = require(\"jsonwebtoken\");\n\nvar errors_1 = require(\"./errors\");\n\nvar AUTO_REFRESH_PREFETCH_TIME = 5000;\nvar ACL_TOKEN_HEADER = \"X-Dgraph-AccessToken\";\nvar ALPHA_AUTH_TOKEN_HEADER = \"X-Dgraph-AuthToken\";\nvar DGRAPHCLOUD_API_KEY_HEADER = \"X-Auth-Token\";\n\nvar DgraphClientStub = function () {\n  function DgraphClientStub(addr, stubConfig, options) {\n    if (stubConfig === void 0) {\n      stubConfig = {};\n    }\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    if (addr === undefined) {\n      this.addr = \"http://localhost:8080\";\n    } else {\n      this.addr = addr;\n    }\n\n    this.options = options;\n    this.legacyApi = !!stubConfig.legacyApi;\n    this.jsonParser = stubConfig.jsonParser !== undefined ? stubConfig.jsonParser : JSON.parse.bind(JSON);\n  }\n\n  DgraphClientStub.prototype.detectApiVersion = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var health, version;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4, this.getHealth()];\n\n          case 1:\n            health = _a.sent();\n            version = health[\"version\"] || health[0].version;\n\n            if (version === undefined) {\n              version = \"1.0.x\";\n            }\n\n            this.legacyApi = version.startsWith(\"1.0.\");\n            return [2, version];\n        }\n      });\n    });\n  };\n\n  DgraphClientStub.prototype.alter = function (op) {\n    var body;\n\n    if (op.schema !== undefined) {\n      body = op.schema;\n    } else if (op.dropAttr !== undefined) {\n      body = JSON.stringify({\n        drop_attr: op.dropAttr\n      });\n    } else if (op.dropAll) {\n      body = JSON.stringify({\n        drop_all: true\n      });\n    } else {\n      return Promise.reject(\"Invalid op argument in alter\");\n    }\n\n    return this.callAPI(\"alter\", __assign(__assign({}, this.options), {\n      method: \"POST\",\n      body: body\n    }));\n  };\n\n  DgraphClientStub.prototype.query = function (req) {\n    var _a;\n\n    var headers = this.options.headers !== undefined ? __assign({}, this.options.headers) : {};\n\n    if (req.vars !== undefined) {\n      if (this.legacyApi) {\n        headers[\"X-Dgraph-Vars\"] = JSON.stringify(req.vars);\n      } else {\n        headers[\"Content-Type\"] = \"application/json\";\n        req.query = JSON.stringify({\n          query: req.query,\n          variables: req.vars\n        });\n      }\n    }\n\n    if (headers[\"Content-Type\"] === undefined && !this.legacyApi) {\n      headers[\"Content-Type\"] = \"application/graphql+-\";\n    }\n\n    var url = \"query\";\n\n    if (this.legacyApi) {\n      if (req.startTs !== 0) {\n        url += \"/\" + req.startTs;\n      }\n\n      if (req.debug) {\n        url += \"?debug=true\";\n      }\n    } else {\n      var params = [];\n\n      if (req.startTs !== 0) {\n        params.push({\n          key: \"startTs\",\n          value: \"\" + req.startTs\n        });\n      }\n\n      if (req.timeout > 0) {\n        params.push({\n          key: \"timeout\",\n          value: req.timeout + \"s\"\n        });\n      }\n\n      if (req.debug) {\n        params.push({\n          key: \"debug\",\n          value: \"true\"\n        });\n      }\n\n      if (req.readOnly) {\n        params.push({\n          key: \"ro\",\n          value: \"true\"\n        });\n      }\n\n      if (req.bestEffort) {\n        params.push({\n          key: \"be\",\n          value: \"true\"\n        });\n      }\n\n      if (((_a = req === null || req === void 0 ? void 0 : req.hash) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n        params.push({\n          key: \"hash\",\n          value: \"\" + req.hash\n        });\n      }\n\n      if (params.length > 0) {\n        url += \"?\";\n        url += params.map(function (_a) {\n          var key = _a.key,\n              value = _a.value;\n          return key + \"=\" + value;\n        }).join(\"&\");\n      }\n    }\n\n    return this.callAPI(url, __assign(__assign({}, this.options), {\n      method: \"POST\",\n      body: req.query,\n      headers: headers\n    }));\n  };\n\n  DgraphClientStub.prototype.mutate = function (mu) {\n    var _a;\n\n    var body;\n    var usingJSON = false;\n\n    if (mu.setJson !== undefined || mu.deleteJson !== undefined) {\n      usingJSON = true;\n      var obj = {};\n\n      if (mu.setJson !== undefined) {\n        obj.set = mu.setJson;\n      }\n\n      if (mu.deleteJson !== undefined) {\n        obj.delete = mu.deleteJson;\n      }\n\n      body = JSON.stringify(obj);\n    } else if (mu.setNquads !== undefined || mu.deleteNquads !== undefined) {\n      body = \"{\\n                \" + (mu.setNquads === undefined ? \"\" : \"set {\\n                    \" + mu.setNquads + \"\\n                }\") + \"\\n                \" + (mu.deleteNquads === undefined ? \"\" : \"delete {\\n                    \" + mu.deleteNquads + \"\\n                }\") + \"\\n            }\";\n    } else if (mu.mutation !== undefined) {\n      body = mu.mutation;\n\n      if (mu.isJsonString !== undefined) {\n        usingJSON = mu.isJsonString;\n      } else {\n        try {\n          JSON.parse(mu.mutation);\n          usingJSON = true;\n        } catch (e) {\n          usingJSON = false;\n        }\n      }\n    } else {\n      return Promise.reject(\"Mutation has no data\");\n    }\n\n    var headers = __assign(__assign({}, this.options.headers !== undefined ? this.options.headers : {}), {\n      \"Content-Type\": \"application/\" + (usingJSON ? \"json\" : \"rdf\")\n    });\n\n    if (usingJSON && this.legacyApi) {\n      headers[\"X-Dgraph-MutationType\"] = \"json\";\n    }\n\n    var url = \"mutate\";\n    var nextDelim = \"?\";\n\n    if (mu.startTs > 0) {\n      url += (!this.legacyApi ? \"?startTs=\" : \"/\") + mu.startTs.toString();\n      nextDelim = \"&\";\n    }\n\n    if (((_a = mu === null || mu === void 0 ? void 0 : mu.hash) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n      if (!this.legacyApi) {\n        url += nextDelim + \"hash=\" + mu.hash;\n      }\n    }\n\n    if (mu.commitNow) {\n      if (!this.legacyApi) {\n        url += nextDelim + \"commitNow=true\";\n      } else {\n        headers[\"X-Dgraph-CommitNow\"] = \"true\";\n      }\n    }\n\n    return this.callAPI(url, __assign(__assign({}, this.options), {\n      method: \"POST\",\n      body: body,\n      headers: headers\n    }));\n  };\n\n  DgraphClientStub.prototype.commit = function (ctx) {\n    var _a;\n\n    var body;\n\n    if (ctx.keys === undefined) {\n      body = \"[]\";\n    } else {\n      body = JSON.stringify(ctx.keys);\n    }\n\n    var url = !this.legacyApi ? \"commit?startTs=\" + ctx.start_ts : \"commit/\" + ctx.start_ts;\n\n    if (((_a = ctx === null || ctx === void 0 ? void 0 : ctx.hash) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n      if (!this.legacyApi) {\n        url += \"&hash=\" + ctx.hash;\n      }\n    }\n\n    return this.callAPI(url, __assign(__assign({}, this.options), {\n      method: \"POST\",\n      body: body\n    }));\n  };\n\n  DgraphClientStub.prototype.abort = function (ctx) {\n    var _a;\n\n    var url = !this.legacyApi ? \"commit?startTs=\" + ctx.start_ts + \"&abort=true\" : \"abort/\" + ctx.start_ts;\n\n    if (((_a = ctx === null || ctx === void 0 ? void 0 : ctx.hash) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n      if (!this.legacyApi) {\n        url += \"&hash=\" + ctx.hash;\n      }\n    }\n\n    return this.callAPI(url, __assign(__assign({}, this.options), {\n      method: \"POST\"\n    }));\n  };\n\n  DgraphClientStub.prototype.login = function (userid, password, refreshToken) {\n    return __awaiter(this, void 0, void 0, function () {\n      var body, res;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (this.legacyApi) {\n              throw new Error(\"Pre v1.1 clients do not support Login methods\");\n            }\n\n            body = {};\n\n            if (userid === undefined && refreshToken === undefined && this.refreshToken === undefined) {\n              throw new Error(\"Cannot find login details: neither userid/password nor refresh token are specified\");\n            }\n\n            if (userid === undefined) {\n              body.refresh_token = refreshToken !== undefined ? refreshToken : this.refreshToken;\n            } else {\n              body.userid = userid;\n              body.password = password;\n            }\n\n            return [4, this.callAPI(\"login\", __assign(__assign({}, this.options), {\n              method: \"POST\",\n              body: JSON.stringify(body)\n            }))];\n\n          case 1:\n            res = _a.sent();\n            this.accessToken = res.data.accessJWT;\n            this.refreshToken = res.data.refreshJWT;\n            this.maybeStartRefreshTimer(this.accessToken);\n            return [2, true];\n        }\n      });\n    });\n  };\n\n  DgraphClientStub.prototype.loginIntoNamespace = function (userid, password, namespace, refreshToken) {\n    return __awaiter(this, void 0, void 0, function () {\n      var body, res;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (this.legacyApi) {\n              throw new Error(\"Pre v1.1 clients do not support Login methods\");\n            }\n\n            body = {};\n\n            if (userid === undefined && refreshToken === undefined && this.refreshToken === undefined) {\n              throw new Error(\"Cannot find login details: neither userid/password nor refresh token are specified\");\n            }\n\n            if (userid === undefined) {\n              body.refresh_token = refreshToken !== undefined ? refreshToken : this.refreshToken;\n            } else {\n              body.userid = userid;\n              body.password = password;\n              body.namespace = namespace;\n            }\n\n            return [4, this.callAPI(\"login\", __assign(__assign({}, this.options), {\n              method: \"POST\",\n              body: JSON.stringify(body)\n            }))];\n\n          case 1:\n            res = _a.sent();\n            this.accessToken = res.data.accessJWT;\n            this.refreshToken = res.data.refreshJWT;\n            this.maybeStartRefreshTimer(this.accessToken);\n            return [2, true];\n        }\n      });\n    });\n  };\n\n  DgraphClientStub.prototype.logout = function () {\n    this.accessToken = undefined;\n    this.refreshToken = undefined;\n  };\n\n  DgraphClientStub.prototype.getAuthTokens = function () {\n    return {\n      accessToken: this.accessToken,\n      refreshToken: this.refreshToken\n    };\n  };\n\n  DgraphClientStub.prototype.fetchUiKeywords = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2, this.callAPI(\"ui/keywords\", this.options)];\n      });\n    });\n  };\n\n  DgraphClientStub.prototype.getHealth = function (all) {\n    if (all === void 0) {\n      all = false;\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2, this.callAPI(\"health\" + (all ? \"?all\" : \"\"), __assign(__assign({}, this.options), {\n          acceptRawText: true\n        }))];\n      });\n    });\n  };\n\n  DgraphClientStub.prototype.getState = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2, this.callAPI(\"state\", this.options)];\n      });\n    });\n  };\n\n  DgraphClientStub.prototype.setAutoRefresh = function (val) {\n    if (!val) {\n      this.cancelRefreshTimer();\n    }\n\n    this.autoRefresh = val;\n    this.maybeStartRefreshTimer(this.accessToken);\n  };\n\n  DgraphClientStub.prototype.setAlphaAuthToken = function (authToken) {\n    if (this.options.headers === undefined) {\n      this.options.headers = {};\n    }\n\n    this.options.headers[ALPHA_AUTH_TOKEN_HEADER] = authToken;\n  };\n\n  DgraphClientStub.prototype.setSlashApiKey = function (apiKey) {\n    this.setCloudApiKey(apiKey);\n  };\n\n  DgraphClientStub.prototype.setCloudApiKey = function (apiKey) {\n    if (this.options.headers === undefined) {\n      this.options.headers = {};\n    }\n\n    this.options.headers[DGRAPHCLOUD_API_KEY_HEADER] = apiKey;\n  };\n\n  DgraphClientStub.prototype.cancelRefreshTimer = function () {\n    if (this.autoRefreshTimer !== undefined) {\n      clearTimeout(this.autoRefreshTimer);\n      this.autoRefreshTimer = undefined;\n    }\n  };\n\n  DgraphClientStub.prototype.maybeStartRefreshTimer = function (accessToken) {\n    var _this = this;\n\n    if (accessToken === undefined || !this.autoRefresh) {\n      return;\n    }\n\n    this.cancelRefreshTimer();\n    var timeToWait = Math.max(2000, jwt.decode(accessToken).exp * 1000 - Date.now() - AUTO_REFRESH_PREFETCH_TIME);\n    this.autoRefreshTimer = setTimeout(function () {\n      return _this.refreshToken !== undefined ? _this.login() : 0;\n    }, timeToWait);\n  };\n\n  DgraphClientStub.prototype.callAPI = function (path, config) {\n    return __awaiter(this, void 0, void 0, function () {\n      var url, response, json, responseText, err, errors;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            url = this.getURL(path);\n            config.headers = config.headers !== undefined ? config.headers : {};\n\n            if (this.accessToken !== undefined && path !== \"login\") {\n              config.headers[ACL_TOKEN_HEADER] = this.accessToken;\n            }\n\n            return [4, fetch(url, config)];\n\n          case 1:\n            response = _a.sent();\n\n            if (response.status >= 300 || response.status < 200) {\n              throw new errors_1.HTTPError(response);\n            }\n\n            return [4, response.text()];\n\n          case 2:\n            responseText = _a.sent();\n\n            try {\n              json = this.jsonParser(responseText);\n            } catch (e) {\n              if (config.acceptRawText) {\n                return [2, responseText];\n              }\n\n              err = new Error(\"Response is not JSON\");\n              err.responseText = responseText;\n              throw err;\n            }\n\n            errors = json.errors;\n\n            if (errors !== undefined) {\n              throw new errors_1.APIError(url, errors);\n            }\n\n            return [2, json];\n        }\n      });\n    });\n  };\n\n  DgraphClientStub.prototype.getURL = function (path) {\n    return \"\" + this.addr + (this.addr.endsWith(\"/\") ? \"\" : \"/\") + path;\n  };\n\n  return DgraphClientStub;\n}();\n\nexports.DgraphClientStub = DgraphClientStub;","map":{"version":3,"sources":["/home/vahan/Desktop/WorldMall/Client/node_modules/dgraph-js-http/lib/clientStub.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","defineProperty","exports","DgraphClientStub","fetch","require","jwt","errors_1","AUTO_REFRESH_PREFETCH_TIME","ACL_TOKEN_HEADER","ALPHA_AUTH_TOKEN_HEADER","DGRAPHCLOUD_API_KEY_HEADER","addr","stubConfig","options","undefined","legacyApi","jsonParser","JSON","parse","bind","detectApiVersion","health","version","_a","getHealth","startsWith","alter","schema","dropAttr","stringify","drop_attr","dropAll","drop_all","callAPI","method","query","req","headers","vars","variables","url","startTs","debug","params","key","timeout","readOnly","bestEffort","hash","map","join","mutate","mu","usingJSON","setJson","deleteJson","obj","set","delete","setNquads","deleteNquads","mutation","isJsonString","nextDelim","toString","commitNow","commit","ctx","keys","start_ts","abort","login","userid","password","refreshToken","res","Error","refresh_token","accessToken","data","accessJWT","refreshJWT","maybeStartRefreshTimer","loginIntoNamespace","namespace","logout","getAuthTokens","fetchUiKeywords","all","acceptRawText","getState","setAutoRefresh","val","cancelRefreshTimer","autoRefresh","setAlphaAuthToken","authToken","setSlashApiKey","apiKey","setCloudApiKey","autoRefreshTimer","clearTimeout","_this","timeToWait","Math","max","decode","exp","Date","now","setTimeout","path","config","response","json","responseText","err","errors","getURL","status","HTTPError","text","APIError","endsWith"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DgraphClientStub = void 0;\nvar fetch = require(\"isomorphic-fetch\");\nvar jwt = require(\"jsonwebtoken\");\nvar errors_1 = require(\"./errors\");\nvar AUTO_REFRESH_PREFETCH_TIME = 5000;\nvar ACL_TOKEN_HEADER = \"X-Dgraph-AccessToken\";\nvar ALPHA_AUTH_TOKEN_HEADER = \"X-Dgraph-AuthToken\";\nvar DGRAPHCLOUD_API_KEY_HEADER = \"X-Auth-Token\";\nvar DgraphClientStub = (function () {\n    function DgraphClientStub(addr, stubConfig, options) {\n        if (stubConfig === void 0) { stubConfig = {}; }\n        if (options === void 0) { options = {}; }\n        if (addr === undefined) {\n            this.addr = \"http://localhost:8080\";\n        }\n        else {\n            this.addr = addr;\n        }\n        this.options = options;\n        this.legacyApi = !!stubConfig.legacyApi;\n        this.jsonParser =\n            stubConfig.jsonParser !== undefined\n                ? stubConfig.jsonParser\n                :\n                    JSON.parse.bind(JSON);\n    }\n    DgraphClientStub.prototype.detectApiVersion = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var health, version;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, this.getHealth()];\n                    case 1:\n                        health = _a.sent();\n                        version = health[\"version\"] || health[0].version;\n                        if (version === undefined) {\n                            version = \"1.0.x\";\n                        }\n                        this.legacyApi = version.startsWith(\"1.0.\");\n                        return [2, version];\n                }\n            });\n        });\n    };\n    DgraphClientStub.prototype.alter = function (op) {\n        var body;\n        if (op.schema !== undefined) {\n            body = op.schema;\n        }\n        else if (op.dropAttr !== undefined) {\n            body = JSON.stringify({ drop_attr: op.dropAttr });\n        }\n        else if (op.dropAll) {\n            body = JSON.stringify({ drop_all: true });\n        }\n        else {\n            return Promise.reject(\"Invalid op argument in alter\");\n        }\n        return this.callAPI(\"alter\", __assign(__assign({}, this.options), { method: \"POST\", body: body }));\n    };\n    DgraphClientStub.prototype.query = function (req) {\n        var _a;\n        var headers = this.options.headers !== undefined\n            ? __assign({}, this.options.headers) : {};\n        if (req.vars !== undefined) {\n            if (this.legacyApi) {\n                headers[\"X-Dgraph-Vars\"] = JSON.stringify(req.vars);\n            }\n            else {\n                headers[\"Content-Type\"] = \"application/json\";\n                req.query = JSON.stringify({\n                    query: req.query,\n                    variables: req.vars,\n                });\n            }\n        }\n        if (headers[\"Content-Type\"] === undefined && !this.legacyApi) {\n            headers[\"Content-Type\"] = \"application/graphql+-\";\n        }\n        var url = \"query\";\n        if (this.legacyApi) {\n            if (req.startTs !== 0) {\n                url += \"/\" + req.startTs;\n            }\n            if (req.debug) {\n                url += \"?debug=true\";\n            }\n        }\n        else {\n            var params = [];\n            if (req.startTs !== 0) {\n                params.push({\n                    key: \"startTs\",\n                    value: \"\" + req.startTs,\n                });\n            }\n            if (req.timeout > 0) {\n                params.push({\n                    key: \"timeout\",\n                    value: req.timeout + \"s\",\n                });\n            }\n            if (req.debug) {\n                params.push({\n                    key: \"debug\",\n                    value: \"true\",\n                });\n            }\n            if (req.readOnly) {\n                params.push({\n                    key: \"ro\",\n                    value: \"true\",\n                });\n            }\n            if (req.bestEffort) {\n                params.push({\n                    key: \"be\",\n                    value: \"true\",\n                });\n            }\n            if (((_a = req === null || req === void 0 ? void 0 : req.hash) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n                params.push({\n                    key: \"hash\",\n                    value: \"\" + req.hash,\n                });\n            }\n            if (params.length > 0) {\n                url += \"?\";\n                url += params\n                    .map(function (_a) {\n                    var key = _a.key, value = _a.value;\n                    return key + \"=\" + value;\n                })\n                    .join(\"&\");\n            }\n        }\n        return this.callAPI(url, __assign(__assign({}, this.options), { method: \"POST\", body: req.query, headers: headers }));\n    };\n    DgraphClientStub.prototype.mutate = function (mu) {\n        var _a;\n        var body;\n        var usingJSON = false;\n        if (mu.setJson !== undefined || mu.deleteJson !== undefined) {\n            usingJSON = true;\n            var obj = {};\n            if (mu.setJson !== undefined) {\n                obj.set = mu.setJson;\n            }\n            if (mu.deleteJson !== undefined) {\n                obj.delete = mu.deleteJson;\n            }\n            body = JSON.stringify(obj);\n        }\n        else if (mu.setNquads !== undefined ||\n            mu.deleteNquads !== undefined) {\n            body = \"{\\n                \" + (mu.setNquads === undefined\n                ? \"\"\n                : \"set {\\n                    \" + mu.setNquads + \"\\n                }\") + \"\\n                \" + (mu.deleteNquads === undefined\n                ? \"\"\n                : \"delete {\\n                    \" + mu.deleteNquads + \"\\n                }\") + \"\\n            }\";\n        }\n        else if (mu.mutation !== undefined) {\n            body = mu.mutation;\n            if (mu.isJsonString !== undefined) {\n                usingJSON = mu.isJsonString;\n            }\n            else {\n                try {\n                    JSON.parse(mu.mutation);\n                    usingJSON = true;\n                }\n                catch (e) {\n                    usingJSON = false;\n                }\n            }\n        }\n        else {\n            return Promise.reject(\"Mutation has no data\");\n        }\n        var headers = __assign(__assign({}, (this.options.headers !== undefined ? this.options.headers : {})), { \"Content-Type\": \"application/\" + (usingJSON ? \"json\" : \"rdf\") });\n        if (usingJSON && this.legacyApi) {\n            headers[\"X-Dgraph-MutationType\"] = \"json\";\n        }\n        var url = \"mutate\";\n        var nextDelim = \"?\";\n        if (mu.startTs > 0) {\n            url +=\n                (!this.legacyApi ? \"?startTs=\" : \"/\") + mu.startTs.toString();\n            nextDelim = \"&\";\n        }\n        if (((_a = mu === null || mu === void 0 ? void 0 : mu.hash) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n            if (!this.legacyApi) {\n                url += nextDelim + \"hash=\" + mu.hash;\n            }\n        }\n        if (mu.commitNow) {\n            if (!this.legacyApi) {\n                url += nextDelim + \"commitNow=true\";\n            }\n            else {\n                headers[\"X-Dgraph-CommitNow\"] = \"true\";\n            }\n        }\n        return this.callAPI(url, __assign(__assign({}, this.options), { method: \"POST\", body: body,\n            headers: headers }));\n    };\n    DgraphClientStub.prototype.commit = function (ctx) {\n        var _a;\n        var body;\n        if (ctx.keys === undefined) {\n            body = \"[]\";\n        }\n        else {\n            body = JSON.stringify(ctx.keys);\n        }\n        var url = !this.legacyApi\n            ? \"commit?startTs=\" + ctx.start_ts\n            : \"commit/\" + ctx.start_ts;\n        if (((_a = ctx === null || ctx === void 0 ? void 0 : ctx.hash) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n            if (!this.legacyApi) {\n                url += \"&hash=\" + ctx.hash;\n            }\n        }\n        return this.callAPI(url, __assign(__assign({}, this.options), { method: \"POST\", body: body }));\n    };\n    DgraphClientStub.prototype.abort = function (ctx) {\n        var _a;\n        var url = !this.legacyApi\n            ? \"commit?startTs=\" + ctx.start_ts + \"&abort=true\"\n            : \"abort/\" + ctx.start_ts;\n        if (((_a = ctx === null || ctx === void 0 ? void 0 : ctx.hash) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n            if (!this.legacyApi) {\n                url += \"&hash=\" + ctx.hash;\n            }\n        }\n        return this.callAPI(url, __assign(__assign({}, this.options), { method: \"POST\" }));\n    };\n    DgraphClientStub.prototype.login = function (userid, password, refreshToken) {\n        return __awaiter(this, void 0, void 0, function () {\n            var body, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.legacyApi) {\n                            throw new Error(\"Pre v1.1 clients do not support Login methods\");\n                        }\n                        body = {};\n                        if (userid === undefined &&\n                            refreshToken === undefined &&\n                            this.refreshToken === undefined) {\n                            throw new Error(\"Cannot find login details: neither userid/password nor refresh token are specified\");\n                        }\n                        if (userid === undefined) {\n                            body.refresh_token =\n                                refreshToken !== undefined ? refreshToken : this.refreshToken;\n                        }\n                        else {\n                            body.userid = userid;\n                            body.password = password;\n                        }\n                        return [4, this.callAPI(\"login\", __assign(__assign({}, this.options), { method: \"POST\", body: JSON.stringify(body) }))];\n                    case 1:\n                        res = _a.sent();\n                        this.accessToken = res.data.accessJWT;\n                        this.refreshToken = res.data.refreshJWT;\n                        this.maybeStartRefreshTimer(this.accessToken);\n                        return [2, true];\n                }\n            });\n        });\n    };\n    DgraphClientStub.prototype.loginIntoNamespace = function (userid, password, namespace, refreshToken) {\n        return __awaiter(this, void 0, void 0, function () {\n            var body, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.legacyApi) {\n                            throw new Error(\"Pre v1.1 clients do not support Login methods\");\n                        }\n                        body = {};\n                        if (userid === undefined &&\n                            refreshToken === undefined &&\n                            this.refreshToken === undefined) {\n                            throw new Error(\"Cannot find login details: neither userid/password nor refresh token are specified\");\n                        }\n                        if (userid === undefined) {\n                            body.refresh_token =\n                                refreshToken !== undefined ? refreshToken : this.refreshToken;\n                        }\n                        else {\n                            body.userid = userid;\n                            body.password = password;\n                            body.namespace = namespace;\n                        }\n                        return [4, this.callAPI(\"login\", __assign(__assign({}, this.options), { method: \"POST\", body: JSON.stringify(body) }))];\n                    case 1:\n                        res = _a.sent();\n                        this.accessToken = res.data.accessJWT;\n                        this.refreshToken = res.data.refreshJWT;\n                        this.maybeStartRefreshTimer(this.accessToken);\n                        return [2, true];\n                }\n            });\n        });\n    };\n    DgraphClientStub.prototype.logout = function () {\n        this.accessToken = undefined;\n        this.refreshToken = undefined;\n    };\n    DgraphClientStub.prototype.getAuthTokens = function () {\n        return {\n            accessToken: this.accessToken,\n            refreshToken: this.refreshToken,\n        };\n    };\n    DgraphClientStub.prototype.fetchUiKeywords = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, this.callAPI(\"ui/keywords\", this.options)];\n            });\n        });\n    };\n    DgraphClientStub.prototype.getHealth = function (all) {\n        if (all === void 0) { all = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, this.callAPI(\"health\" + (all ? \"?all\" : \"\"), __assign(__assign({}, this.options), { acceptRawText: true }))];\n            });\n        });\n    };\n    DgraphClientStub.prototype.getState = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, this.callAPI(\"state\", this.options)];\n            });\n        });\n    };\n    DgraphClientStub.prototype.setAutoRefresh = function (val) {\n        if (!val) {\n            this.cancelRefreshTimer();\n        }\n        this.autoRefresh = val;\n        this.maybeStartRefreshTimer(this.accessToken);\n    };\n    DgraphClientStub.prototype.setAlphaAuthToken = function (authToken) {\n        if (this.options.headers === undefined) {\n            this.options.headers = {};\n        }\n        this.options.headers[ALPHA_AUTH_TOKEN_HEADER] = authToken;\n    };\n    DgraphClientStub.prototype.setSlashApiKey = function (apiKey) {\n        this.setCloudApiKey(apiKey);\n    };\n    DgraphClientStub.prototype.setCloudApiKey = function (apiKey) {\n        if (this.options.headers === undefined) {\n            this.options.headers = {};\n        }\n        this.options.headers[DGRAPHCLOUD_API_KEY_HEADER] = apiKey;\n    };\n    DgraphClientStub.prototype.cancelRefreshTimer = function () {\n        if (this.autoRefreshTimer !== undefined) {\n            clearTimeout(this.autoRefreshTimer);\n            this.autoRefreshTimer = undefined;\n        }\n    };\n    DgraphClientStub.prototype.maybeStartRefreshTimer = function (accessToken) {\n        var _this = this;\n        if (accessToken === undefined || !this.autoRefresh) {\n            return;\n        }\n        this.cancelRefreshTimer();\n        var timeToWait = Math.max(2000, jwt.decode(accessToken).exp * 1000 -\n            Date.now() -\n            AUTO_REFRESH_PREFETCH_TIME);\n        this.autoRefreshTimer = (setTimeout(function () { return (_this.refreshToken !== undefined ? _this.login() : 0); }, timeToWait));\n    };\n    DgraphClientStub.prototype.callAPI = function (path, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var url, response, json, responseText, err, errors;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        url = this.getURL(path);\n                        config.headers = config.headers !== undefined ? config.headers : {};\n                        if (this.accessToken !== undefined && path !== \"login\") {\n                            config.headers[ACL_TOKEN_HEADER] = this.accessToken;\n                        }\n                        return [4, fetch(url, config)];\n                    case 1:\n                        response = _a.sent();\n                        if (response.status >= 300 || response.status < 200) {\n                            throw new errors_1.HTTPError(response);\n                        }\n                        return [4, response.text()];\n                    case 2:\n                        responseText = _a.sent();\n                        try {\n                            json = this.jsonParser(responseText);\n                        }\n                        catch (e) {\n                            if (config.acceptRawText) {\n                                return [2, responseText];\n                            }\n                            err = (new Error(\"Response is not JSON\"));\n                            err.responseText = responseText;\n                            throw err;\n                        }\n                        errors = json.errors;\n                        if (errors !== undefined) {\n                            throw new errors_1.APIError(url, errors);\n                        }\n                        return [2, json];\n                }\n            });\n        });\n    };\n    DgraphClientStub.prototype.getURL = function (path) {\n        return \"\" + this.addr + (this.addr.endsWith(\"/\") ? \"\" : \"/\") + path;\n    };\n    return DgraphClientStub;\n}());\nexports.DgraphClientStub = DgraphClientStub;\n"]},"metadata":{},"sourceType":"script"}